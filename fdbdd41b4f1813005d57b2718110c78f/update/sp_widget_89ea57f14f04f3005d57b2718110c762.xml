<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function SPFloatingViewport($log, $scope, $element, $document, spModal, $q, $timeout, $window) {
	"use strict";

	/* widget controller */
	var $fvp = this;

	$fvp.alt_icon = $fvp.options.use_retina_icon == "true";
	$fvp.isWindowVisible = false;
	$fvp.hasUnreadMessages = false;
	$fvp.firstPress = false;
	$fvp.source = "";
	$fvp.embedWidget = true;
	$fvp.is_sp_page = $fvp.options.is_sp_page && !$fvp.embedWidget;

	$fvp.toggleWindow = function toggleWindow() {
		$fvp.popoverIsOpen = false;
		if ($fvp.isWindowVisible) {
			$fvp.isWindowVisible = false;
		} else {
			$fvp.popoverIsOpen = false;
			if (!$fvp.firstPress) {
				$fvp.firstPress = true;

				$fvp.source =
					"/" +
					$fvp.options.embedded_page +
					"?sysparm_nostack=true&sysparm_stack=no" +
					$fvp.options.url_system_parameters;
			}
			$fvp.hasUnreadMessages = false;
			$timeout(function() {
				if (!$fvp.isWindowVisible) {
					$fvp.isWindowVisible = true;
				}
			}, 300);
		}
	};

	$fvp.showPopover = function showPopover() {
		if (!$fvp.isWindowVisible) {
			$fvp.popoverIsOpen = true;
		}
	};

	$fvp.hidePopover = function hidePopover() {
		$fvp.popoverIsOpen = false;
	};

	function initialShowPopover() {
		$fvp.popoverInitial = false;
		$fvp.popoverIsOpen = true;
		$timeout($fvp.hidePopover, 6000);
	}

	$fvp.popoverInitial = true;
	$timeout(initialShowPopover, 1000);

	$window.addEventListener("message", function(e) {
		if ($fvp.isWindowVisible === false) {
			$fvp.hasUnreadMessages = true;
		}
	});

	$element.find(".help-button").on("mouseup", function(e) {
		e.target.blur();
		e.stopPropagation();
	});

	$element.find(".help-icon").on("mouseup", function(e) {
		e.target.blur();
		e.stopPropagation();
	});

	$fvp.openWindow = function openWindow() {
		$fvp.isWindowVisible = true;
		// delay before clearing unread message indicator
		// in-case user opens and closes quickly
		$timeout(function() {
			if ($fvp.isWindowVisible) {
				$fvp.hasUnreadMessages = false;
			}
		}, 500);
	};

}
]]></client_script>
        <controller_as>$fvp</controller_as>
        <css>$window-width: 375px;
$window-height: 600px;
$button-height: 60px;
$bottom-margin: 15px;

//Used by SP Virtual Agent
$sn-chatbot-animation-speed: 300ms;

// OVERRIDE TO DISPLAY RECORD CARDS
.sn-card-component_records {
  display: block !important;
}

.fvpbtn-container {
  position: fixed;
  right: 30px;
  bottom: 15px;
  z-index: 20;

  .fvp {
    position: relative;
    opacity: 0;
    visibility: hidden;


    &amp;.open {
      transition: $sn-chatbot-animation-speed ease-in opacity;
      opacity: 1;
      visibility: visible;

    }
  }


  .fvp-button {
    position: relative;
    width: 60px;
    color: $btn-info-color;
    background-color: $btn-info-bg;
    float: right;
    border: none;
    height: $button-height;
    border-radius: 60px;
    box-shadow: 0px 2px 11px $btn-info-border;
    -moz-box-shadow: 0px 2px 11px $btn-info-border;
    -o-box-shadow: 0px 2px 11px $btn-info-border;
    padding: 0;
    
    &amp;::before {
      content: "";
      background-color: $btn-info-bg;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      position: absolute;
      top: 0;
      left: 0;
      box-shadow: 0 0 15px darken($btn-info-border, 10%);
      animation: glow-grow 2s ease-out 4;
    }

    &amp;:hover::before {
      background-color: darken($btn-info-border, 10%);
    }


    &amp;:focus {
      outline: thin dotted;
      outline-color: gray;
      outline: 5px auto -webkit-focus-ring-color;
      outline-offset: 2px;
    }


    &amp;.state-unread {
      &amp; &gt; span:after {
        content: ' ';
        position: absolute;
        top: -17px;
        right: -14px;
        width: 16px;
        height: 16px;
        background-color: #ed6e5c;
        border-radius: 25px;
      }
    }
    .fvp-icon {
      pointer-events: none;
      position: relative;
      top: 50%;
      -webkit-transform: perspective(1px) translateY(-50%);
      -ms-transform: perspective(1px) translateY(-50%);
      transform: perspective(1px) translateY(-50%);
    }

    .icon-open {
      font-size: 28px;
      position: relative;
      line-height: 1;
      top: 3px;
    }

    .icon-close {
      font-size: 20px;
    }
    .fa-icon {
      font-size: 28px;
      position: relative;
    }
  }
}

@keyframes glow-grow {
  0% {transform: scale(1);}
  100% {transform: scale(1.8);}
}

// window sizing
.fvp-outer-wrapper {
  position: relative;
  bottom: 15px;
  right: 0;
  display: block;

  .fvp-wrapper {
    width: $window-width; 
    transition: 
      border-bottom: 1px solid #bdc0c4;
    margin-right: 0;
    right: 0;
    box-shadow: 0px 2px 11px #ababab !important;
    -moz-box-shadow: 0px 2px 11px #ababab !important;
    -o-box-shadow: 0px 2px 11px #ababab !important;
    transition: max-height 0s $sn-chatbot-animation-speed;
    display: block;

    .fvp-container {
      height: 100%;
      display: block;

      .fvp-frame {
        max-height: $window-height;
        height: calc(100vh - $button-height - ($bottom-margin * 3));
        width: $window-width;
        margin-bottom: -5px;
        border: none;
        overflow: hidden;
        background-color: #fff;
      }

      // Immediate div is autogenerated from serviceportal
      &amp; &gt; div {
        height: 100%;
      }
    }
  }
}

// Mobile SCSS
@media (max-width: 425px) {  
  .fvpbtn-container {
    right: 15px;
  }
  .fvp-outer-wrapper{
    .fvp-wrapper {
      position: fixed;
      max-height: 100%;
      width: 100%;
      left: 0;
      right: 0;
      bottom: calc($button-height + 20px);
      top: 0;

      .fvp-container {
        position: absolute;
        max-height: 100%;
        width: 100%;
        height: 100%;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;

        .fvp-frame {
          position: absolute;
          width: 100%;
          max-height: calc(100vh + 60px);
          height: 100%;
          left: 0;
          right: 0;
          top: 0;
          bottom: 0;
        }
      }
    }
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data>{"options": {
	"aria_button_label": "dialog",
	"va_url_params": "",
	"button_color": "#428bca",
	"embedded_page": "",
	"retina_icon": "icon-collaboration",
	"fa_icon": "fa-comments-o",
	"is_sp_page": true,
	"use_retina_icon": false
}}</demo_data>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>dmk_kb_floating_viewport</id>
        <internal>false</internal>
        <link><![CDATA[/* exported link */
function link(scope,el,attrs,ctrl){

	scope.$on('suppressHeader', function(action,data){

		var iframe = document.getElementById(data).contentDocument;
		var nav;

		var wait = setInterval(function(){
			nav = iframe.getElementsByTagName('nav')[0];	
			if(nav != undefined){
				try{
					nav.style.display = 'none';
				}catch(e){
					console.log(e);
				}
				clearInterval(wait);
			}
		});

	});
}]]></link>
        <name>DMK KB Floating Viewport</name>
        <option_schema>[{"hint":"The color of the floating button which opens the floating dialog page.","name":"button_color","section":"Presentation","default_value":"#428bca","label":"Floating Button Color","type":"string"},{"hint":"Service Portal Page to embed in the floating dialog","name":"embedded_page","section":"Presentation","label":"Embedded Page","type":"string"},{"hint":"Text for populating the button's ARIA label property","name":"aria_button_label","section":"Data","default_value":"Open the Dialog","label":"ARIA Button Label","type":"string"},{"hint":"String of any additional System Parameters (sysparm_#) needed to support the embedded page.  Must start with the ampersand '&amp;'.","name":"url_system_parameters","section":"Data","label":"Additional URL System Parameters","type":"string"},{"name":"is_sp_page","section":"Behavior","default_value":"true","label":"Embedded Page is a Service Portal Page","type":"boolean"},{"hint":"Text name of Retina Icon listed on HI - https://hi.service-now.com/styles/retina_icons/retina_icons.html","name":"retina_icon","section":"Presentation","default_value":"icon-collaboration","label":"Button Open - Retina Icon","type":"string"},{"hint":"Provide the FontAwesome icon name  based on the FontAwesome 4.7 list - https://fontawesome.com/v4.7.0/icons/ - e.g. fa-comments-o","name":"fa_icon","section":"Presentation","default_value":"fa-comments-o","label":"Button Open - Font Awesome Icon","type":"string"},{"name":"use_retina_icon","section":"Behavior","default_value":"true","label":"Use Retina Icon","type":"boolean"},{"displayValue":"Knowledge","name":"kb_article_sysid","section":"Data","label":"KB Article SysID","type":"reference","value":"kb_knowledge","ed":{"reference":"kb_knowledge"}}]</option_schema>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function floatingViewport() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	options.embedded_page = options.embedded_page || "";
	options.url_system_parameters = options.url_system_parameters || "";
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>chad.hall</sys_created_by>
        <sys_created_on>2019-03-08 17:13:01</sys_created_on>
        <sys_id>89ea57f14f04f3005d57b2718110c762</sys_id>
        <sys_mod_count>85</sys_mod_count>
        <sys_name>DMK KB Floating Viewport</sys_name>
        <sys_package display_value="Vehicle Tolls" source="x_89907_vehicle_to">fdbdd41b4f1813005d57b2718110c78f</sys_package>
        <sys_policy/>
        <sys_scope display_value="Vehicle Tolls">fdbdd41b4f1813005d57b2718110c78f</sys_scope>
        <sys_update_name>sp_widget_89ea57f14f04f3005d57b2718110c762</sys_update_name>
        <sys_updated_by>chad.hall</sys_updated_by>
        <sys_updated_on>2019-08-16 12:12:49</sys_updated_on>
        <template><![CDATA[<div class="fvpbtn-container">
  <div class="fvp fade" 
       ng-class="{'open': $fvp.isWindowVisible}">
    <div class="fvp-outer-wrapper" ng-show="$fvp.isWindowVisible">
      <div class="fvp-wrapper loaded">
        <div class="fvp-container">
          <iframe ng-if="!$fvp.embedWidget" id='fvpFrame' class="fvp-frame"
                  scrolling="no"
                  horizontalscrolling="no"
                  verticalscrolling="no"
                  frameborder="none" 
                  ng-src="{{$fvp.source}}">
          </iframe>
          <div ng-if="$fvp.embedWidget && $fvp.options.kb_article_sysid" style="max-height: 700px; overflow-y: scroll; height: 700px;">
           <widget id="dmk-kb-article-content" options='{"sys_id": options.kb_article_sysid}'></widget>
          </div>
        </div> <!-- end fvp-container -->
      </div> <!-- end fvp-wrapper loaded -->
    </div> <!-- end fvp-outer-wrapper -->
  </div> <!-- end fvp fade -->
  <button 
          type="button"
          uib-popover="What is personal use?" 
          popover-placement="top-right"
  	    			popover-trigger="none"
              popover-is-open="$fvp.popoverIsOpen"
              ng-mouseenter="$fvp.showPopover()" 
              ng-mouseleave="$fvp.hidePopover()"
          aria-label="${$fvp.options.aria_button_label}" 
          class="fvp-button"
          ng-class="{'state-open': ($fvp.isWindowVisible || true), 'state-unread': $fvp.hasUnreadMessages}" 
          ng-click="$fvp.toggleWindow()"
          ng-attr-tabindex="0">
		<div class="hover-overlay"></div>
    <span ng-if='!$fvp.alt_icon' aria-hidden="true" class="fvp-icon ">
      <i ng-class="$fvp.isWindowVisible ? 'icon-close fa-icon fa fa-close' : 'icon-open fa-icon fa fa-info'" aria-hidden='true'></i>
    </span>
    <span ng-if='$fvp.alt_icon' aria-hidden="true"
          ng-class="$fvp.isWindowVisible ? 'fvp-icon icon-close icon-cross' : 'fvp-icon icon-open {{$fvp.options.retina_icon}}'"
          ></span>
  </button>  
</div>]]></template>
    </sp_widget>
</record_update>
